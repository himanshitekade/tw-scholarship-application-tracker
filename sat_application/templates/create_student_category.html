{% extends 'base.html' %}
{% load static %}
{% block content %}
<!-- Page Loader Start -->
<div id="loader-wrapper" style="display: none;align-items: center;justify-content: center;position: fixed;
    top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0, 0, 0, 0.5); z-index: 9999; ">
    <div id="loader" class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
</div>
<!-- Page Loader End -->

<div class="nk-content ">
	<div class="container-fluid">
		<div class="nk-content-inner">
			<div class="nk-content-body">
				<div class="nk-block-head nk-block-head-sm">
					<div class="nk-block-between">
						<div class="nk-block-head-content">
							<h3 class="nk-block-title page-title">Add Details</h3>
							<div class="nk-block-des text-soft">

							</div>
						</div><!-- .nk-block-head-content -->
						<div class="nk-block-head-content">
							<div class="toggle-wrap nk-block-tools-toggle">
							</div><!-- .toggle-wrap -->
						</div><!-- .nk-block-head-content -->
					</div><!-- .nk-block-between -->
				</div><!-- .nk-block-head -->
				<form action="{% url redirect %}" method="post" enctype="multipart/form-data">
					{% csrf_token %}
					<div class="nk-block">
						<div class="card card-bordered card-stretch">
							<div class="card-inner-group">
								<div class="card-inner position-relative card-tools-toggle">
									<div class="row gy-4">

										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
												<label for="category_name" class="form-label"> Category name </label>

												<span style="color:red;">*</span>

												<div class="form-control-wrap">
													<input type="text" class="form-control" id="category_name"
														name="category_name" value=""
														placeholder="Enter your category name" required>
												</div>
											</div>
										</div><!--col-->									

										<div class="col-xxl-3 col-md-6" hidden>
											<div class="form-control-wrap">
											  	<label class="form-label" for="student_category_session">Select Session</label>
											  	<span style="color:red;">*</span>
											  	<select class="form-select field" id="student_category_session" name="student_category_session">
													<option value="{{ current_year_id.id }}" selected>{{current_year_id.year}}</option> 
												</select>
											</div>
										</div>

										<!-- Changes Start -->
										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
											  <label class="form-label" for="application_type">Application type</label>
											  <span style="color:red;">*</span>
											  <div class="form-control-wrap"> 
												<select class="form-select field" id="application_type" name="application_type" required>
													<option value="" selected>-- Select --</option>
													{% for application in application_type %}
														<option value="{{ application.name }}">{{ application.name }}</option>
													{% endfor %}
												</select>
											  </div>
											</div>
										</div>
										<!-- Changes end -->

										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
												<label for="no_of_candidates" class="form-label"> No. of candidates
												</label>

												<span style="color:red;">*</span>

												<div class="form-control-wrap">
													<input type="number" class="form-control" id="no_of_candidates"
														name="no_of_candidates" placeholder="Enter no of candidates "
														required onkeyup="TotalAmount()">
												</div>
											</div>
										</div><!--col-->

										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
												<label for="amt_for_candidates" class="form-label"> Amount for
													candidates </label>

												<span style="color:red;">*</span>

												<div class="form-control-wrap">
													<input type="number" class="form-control" id="amt_for_candidates"
														name="amt_for_candidates"
														placeholder="Enter amount for candidates" required onkeyup="TotalAmount()">
												</div>
											</div>
										</div><!--col-->

										<!-- Changes Start -->
										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
											  <label class="form-label" for="courses_link">Courses</label>
											  <span style="color:red;">*</span>
											  <div class="form-control-wrap"> 
												<select class="form-select field" id="courses_link" name="courses_link" required multiple onchange="CheckCategoryExist()">
													<option value="" disabled>-- Select --</option>
													{% for course in courses %}
														<option value="{{ course.name }}">{{ course.name }}</option>
													{% endfor %}
												</select>
											  </div>
											</div>
										</div>
										<!-- Changes end -->

										<div class="col-xxl-3 col-md-6">
											<div class="form-group">
												<label for="total_amt" class="form-label"> Total Amount </label>

												<span style="color:red;">*</span>

												<div class="form-control-wrap">
													<input type="number" class="form-control" id="total_amt"
														name="total_amt" placeholder="Enter total amount" required readonly>
												</div>
											</div>
										</div><!--col-->

										<div class="col-12">
											<span id="alert_msg" style="color:red;" class="fw-bold"></span>
											<div class="form-group">
												<button type="submit" class="btn btn-success" name="action"
													value="" id="submit_btn" disabled>Submit</button>

											</div><!--col-->


										</div><!--row-->
									</div><!-- .card-inner -->
								</div><!-- .card-inner-group -->
							</div><!-- .card -->
						</div><!-- .nk-block -->
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Check if category exist (Session , Application_type, Courses) -->
<script>
	function CheckCategoryExist(){
		var application_type = document.getElementById("application_type").options[document.getElementById("application_type").selectedIndex].value;  
		var student_category_session = document.getElementById("student_category_session").options[document.getElementById("student_category_session").selectedIndex].value;  
		
		var selectElement = document.getElementById("courses_link");
		// Get the selected options
		var selectedValues = Array.from(selectElement.selectedOptions)
			.map(option => option.value);

		// Create a string of selected values
		var selected_courses = selectedValues.join(", ");
		
		console.log("application_type:-",application_type);
		console.log("student_category_session:-",student_category_session);
		console.log("selected_courses:-",selected_courses);

		$.ajax({
            url: "{% url 'studentcategory' %}",
            method: "GET",
            data: {
                application_type:application_type,
                student_category_session:student_category_session,
                selected_courses:selected_courses,
                action:"check_category_exist",  // Provide the category value as needed
            },
            success: function (data) {
				console.log("status:-",data.status)

				if(data.status === "Exist"){
					
					document.getElementById('submit_btn').disabled = true;	
					document.getElementById('alert_msg').innerHTML = "Category Already Exist.";
					
				}
				else{
					document.getElementById('submit_btn').disabled = false;	
					document.getElementById('alert_msg').innerHTML = "";
				}

            },
            error: function (error) {
                console.log("error",error);
            }
        });
	}
</script>


<script>
	function TotalAmount(){
		var no_of_candidates = document.getElementById("no_of_candidates").value;
		var amt_for_candidates = document.getElementById("amt_for_candidates").value;
		var total_amt = document.getElementById('total_amt');
		total_amt.value = no_of_candidates * amt_for_candidates
		console.log(total_amt)

	}
</script>


{% endblock content %}

{% block script %}
<script src="{% static 'assets/js/checkboxValidation.js' %}"></script>
{% endblock script %}